services:
  windows:
    image: dockurr/windows                                                # https://github.com/dockur/windows
    container_name: win
    environment:
      VERSION: "${OS_V:-win7}"                                            # ç³»ç»Ÿæ ‡è¯†  win7  win10 æˆ–è€… https://drive.massgrave.dev/zh-cn_windows_10_enterprise_ltsc_2021_x64_dvd_033b7312.iso
      DISK_SIZE: "${DISK_S:-30G}"                                         # åˆ†é…å‚¨å­˜ç©ºé—´
      DISK_FMT: "${DISK_F:-qcow2}"                                        # è™šæ‹Ÿç£ç›˜å­˜å‚¨æ–¹å¼  ram | qcow2
      RAM_SIZE: "${MEM_S:-2G}"                                            # åˆ†é…çš„å†…å­˜
      CPU_CORES: "${CPU_C:-2}"                                            # åˆ†é…çš„æ ¸å¿ƒ
      LANGUAGE: "${LANG:-Chinese}"                                        # ç³»ç»Ÿè¯­è¨€ English | Chinese
      USERNAME: "${USER:-docker}"                                         # windowsç™»å½•è´¦å·
      PASSWORD: "${PASSWD:-docker}"                                       # windowsç™»å½•å¯†ç 
      # DHCP: "Y"                                                         # ğŸ’¡æ³¨é”€è¿™è¡Œå¼€å¯è·¯ç”±å™¨ç½‘æ®µåˆ†é…IP
      # ARGUMENTS: "-device usb-host,vendorid=0x232b,productid=0x0f13"    # ğŸš©è°ƒç”¨usbåˆ°å®¹å™¨ è°ƒæ•´å’Œä¸Šé¢lsusbè¾“å‡ºä¸€è‡´ï¼ŒåŠ 0xè¡¨ç¤ºä¸ºåå…­è¿›åˆ¶
    devices:
      - /dev/kvm
      # - /dev/bus/usb                                                    # ğŸš©è°ƒç”¨usbåˆ°å®¹å™¨
    # device_cgroup_rules:                                                # ğŸ’¡æ³¨é”€è¿™è¡Œå¼€å¯è·¯ç”±å™¨ç½‘æ®µåˆ†é…IP
    #   - 'c *:* rwm'                                                     # ğŸ’¡æ³¨é”€è¿™è¡Œå¼€å¯è·¯ç”±å™¨ç½‘æ®µåˆ†é…IP
    cap_add:
      - NET_ADMIN
    # ports:                                                              # ğŸ·ï¸å¼€å¯ç«¯å£æ˜ å°„
    #   - 8006:8006                                                       # ğŸ·ï¸å’Œé£ç‰›ç›¸å†Œ8006ç«¯å£å†²çª
    #   - 3389:3389/tcp                                                   # ğŸ·ï¸è¿œç¨‹ç»ˆç«¯ç«¯å£
    #   - 3389:3389/udp                                                   # ğŸ·ï¸è¿œç¨‹ç»ˆç«¯ç«¯å£
    stop_grace_period: 2m
    volumes:
      - win_data:/storage
        ${BOOT_PATH_ARGS:-}
    # - /var/win11.iso:/custom.iso                                         # è‡ªå®šä¹‰å¯åŠ¨å…‰ç›˜æ–‡ä»¶
      - /mnt:/shared                                                       # windowså’Œå®¿ä¸»æœºæ–‡ä»¶å…±äº«ç›®å½•
    networks:
      vlan:
        ipv4_address: "${IP:-172.19.0.13}"                                 # ä¿®æ”¹ä¸åŒçš„IPã€*ã€‘  WEBVNCåœ°å€ï¼š http://<ip>:8006  RDPåœ°å€ï¼š<ip>:3389
networks:
  vlan:
    external: true
volumes:
  win_data:

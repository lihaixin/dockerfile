###############################################################
# æœ¬èŒƒä¾‹æ¥æºä¸ºç½‘å‹
# æ­£å¸¸ä¸Šç½‘ç”¨ æ·»åŠ é“¾å¼ä»£ç†
# æ„ä¸ºã€Œæ²¡æœ‰å‘½ä¸­è§„åˆ™çš„ç½‘ç»œæµé‡ï¼Œç»Ÿç»Ÿä½¿ç”¨ä»£ç†ã€
# é€‚ç”¨äºæœåŠ¡å™¨çº¿è·¯ç½‘ç»œè´¨é‡ç¨³å®šã€å¿«é€Ÿï¼Œä¸ç¼ºæœåŠ¡å™¨æµé‡çš„ç”¨æˆ·
# æ–°æ‰‹ç”¨æˆ·15050999ä¸“ç”¨ç‰ˆ
# https://github.com/Loyalsoldier/clash-rules
###############################################################

socks-port: $S5PORT
port: $HTTPPORT
mixed-port: $CLASH_MIXED_PORT
redir-port: 7891
tproxy-port: 7892
#---------------------------------------------------#
## é…ç½®æ–‡ä»¶éœ€è¦æ”¾ç½®åœ¨ /etc/clash/*.yaml
allow-lan: true
mode: rule                             # rule / global / direct / (default is rule)
log-level: info                        # info / warning / error / debug / silent
external-controller: 0.0.0.0:9090
external-ui: /etc/clash/ui
# secret: "11051855-1667-4c8d-8c86-a3e3a47430bb"
# TCPå¹¶å‘è¿æ¥å°†ä½¿ç”¨æ‰€æœ‰IPè¿›è¡ŒTCPæ¡æ‰‹ï¼Œå¹¶ä½¿ç”¨æœ€å…ˆæ¡æ‰‹çš„IPè¿›è¡Œåç»­è¯·æ±‚
tcp-concurrent: true
store-selected: true
#  find-process-mode has 3 values:always, strict, off
#  - always, å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#  - strict, é»˜è®¤ï¼Œç”± mihomo åˆ¤æ–­æ˜¯å¦å¼€å¯
#  - off, ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: off

sniffer:                               #ã€Metaä¸“å±ã€‘snifferåŸŸåå—…æ¢å™¨
  enable: true                         # å—…æ¢å¼€å…³
  sniffing:                            # å—…æ¢åè®®å¯¹è±¡ï¼šç›®å‰æ”¯æŒtls/http
    - tls
    - http

  skip-domian:                         # åˆ—è¡¨ä¸­çš„sniå­—æ®µï¼Œä¿ç•™mappingç»“æœï¼Œä¸é€šè¿‡å—…æ¢è¿˜åŸåŸŸåï¼Œä¼˜å…ˆçº§æ¯”force-domainé«˜
    - 'Mijia Cloud'                    # ç±³å®¶è®¾å¤‡ï¼Œå»ºè®®åŠ 
    - 'dlg.io.mi.com'
    - '+.apple.com'                    # è‹¹æœåŸŸåï¼Œå»ºè®®åŠ 
  # - '*.baidu.com'                    # æ”¯æŒé€šé…ç¬¦

  force-domain:                        # éœ€è¦å¼ºåˆ¶å—…æ¢çš„åŸŸåï¼Œé»˜è®¤åªå¯¹IPå—…æ¢
  # - ''                               # å»æ‰æ³¨é‡Šåç­‰äºå…¨å±€å—…æ¢
    - '+.google.com'
    - '+.v2ex.com'
    
tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - any:53
dns:
  enable: true                         # DNSå¼€å…³(false/true)
  listen: 0.0.0.0:1053                 # DNSç›‘å¬åœ°å€
  # enhanced-mode: redir-host
  ipv6: false                          # IP6è§£æå¼€å…³ï¼›å¦‚æœä¸ºfalseï¼Œå°†è¿”å›ip6ç»“æœä¸ºç©º

  nameserver:                         # é»˜è®¤DNSæœåŠ¡å™¨ï¼Œæ”¯æŒudp/tcp/dot/doh/doq
    - tls://223.6.6.6:853
    - tls://223.5.5.5:853

  fallback:                           # å›è½DNSæœåŠ¡å™¨ï¼Œæ”¯æŒudp/tcp/dot/doh/doq
    - tls://1.1.1.1:853               #ã€Metaä¸“å±ã€‘"#DNS"ä»£è¡¨è¯¥DNSæœåŠ¡å™¨é€šè¿‡åä¸º"DNS"çš„proxy Groupè®¿é—®
    - tls://9.9.9.9:853

  fallback-filter:                    # å›è½DNSæœåŠ¡å™¨è¿‡æ»¤
    geoip: true                       # ä¸ºçœŸæ—¶ï¼Œä¸åŒ¹é…ä¸ºgeoipè§„åˆ™çš„ä½¿ç”¨fallbackè¿”å›ç»“æœ
    geoip-code: CN                    # geoipåŒ¹é…åŒºåŸŸè®¾å®š
    ipcidr:                           # åˆ—è¡¨ä¸­çš„ipä½¿ç”¨fallbackè¿”å›è§£æç»“æœ
      - 0.0.0.0/8
      - 10.0.0.0/8
      - 100.64.0.0/10
      - 127.0.0.0/8
      - 169.254.0.0/16
      - 172.16.0.0/12
      - 192.0.0.0/24
      - 192.0.2.0/24
      - 192.88.99.0/24
      - 192.168.0.0/16
      - 198.18.0.0/15
      - 198.51.100.0/24
      - 203.0.113.0/24
      - 224.0.0.0/4
      - 233.252.0.0/24
      - 240.0.0.0/4
      - 255.255.255.255/32
      - 74.125.127.102/32
      - 74.125.155.102/32
      - 74.125.39.102/32
      - 74.125.39.113/32
      - 209.85.229.138/32
      - 128.121.126.139/32
      - 159.106.121.75/32
      - 169.132.13.103/32
      - 192.67.198.6/32
      - 202.106.1.2/32
      - 202.181.7.85/32
      - 203.161.230.171/32
      - 203.98.7.65/32
      - 207.12.88.98/32
      - 208.56.31.43/32
      - 209.145.54.50/32
      - 209.220.30.174/32
      - 209.36.73.33/32
      - 211.94.66.147/32
      - 213.169.251.35/32
      - 216.221.188.182/32
      - 216.234.179.13/32
      - 37.61.54.158/32
      - 4.36.66.178/32
      - 46.82.174.68/32
      - 59.24.3.173/32
      - 64.33.88.161/32
      - 64.33.99.47/32
      - 64.66.163.251/32
      - 65.104.202.252/32
      - 65.160.219.113/32
      - 66.45.252.237/32
      - 69.55.52.253/32
      - 72.14.205.104/32
      - 72.14.205.99/32
      - 78.16.49.15/32
      - 8.7.198.45/32
      - 93.46.8.89/32
      - 37.61.54.158/32
      - 190.93.247.4/32
      - 190.93.246.4/32
      - 190.93.245.4/32
      - 190.93.244.4/32
      - 65.49.2.178/32
      - 189.163.17.5/32
      - 23.89.5.60/32
      - 49.2.123.56/32
      - 54.76.135.1/32
      - 77.4.7.92/32
      - 118.5.49.6/32
      - 159.24.3.173/32
      - 188.5.4.96/32
      - 197.4.4.12/32
      - 220.250.64.24/32
      
# èŠ‚ç‚¹é…ç½®æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ /etc/clash/proxies/ ç›®å½•ä¸­
proxy-providers:
  # ä»é“¾æ¥å¯¼å…¥çš„é…ç½®æ–‡ä»¶
  $CLASH_SUBNAME:
    type: $CLASH_SUBTYPE
    path: /etc/clash/proxies/$CLASH_SUBNAME.yaml
    url: $CLASH_SUBURL
    interval: 3600 
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      
proxy-groups:
  - name: PROXY
    type: select
    # disable-udp: true
    url: https://www.gstatic.com/generate_204
    interval: 300
    proxies:
      - é“¾å¼ä¸­è½¬
      - é“¾å¼è½åœ°
      - ä¸­è½¬ä»£ç†
  # åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - name: é¦™æ¸¯
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)æ¸¯|hk|hongkong|hong kong"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/HK.png"
    use:
      - $CLASH_SUBNAME
  - name: å°æ¹¾
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)å°|tw|taiwan"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/TW.png"
    use:
      - $CLASH_SUBNAME
  - name: æ—¥æœ¬
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)æ—¥|jp|japan"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/JP.png"
    use:
      - $CLASH_SUBNAME
  - name: éŸ©å›½
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)éŸ©|kr|korea"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/KR.png"
    use:
      - $CLASH_SUBNAME
  - name: ç¾å›½
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)ç¾|us|unitedstates|united states"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/US.png"
    use:
      - $CLASH_SUBNAME
  - name: æ–°åŠ å¡
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)(æ–°|sg|singapore)"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/SG.png"
    use:
      - $CLASH_SUBNAME
  - name: å…¶å®ƒ
    type: load-balance
    interval: 3600 
    url: http://www.gstatic.com/generate_204
    strategy: consistent-hashing # å¯é€‰ round-robin å’Œ sticky-sessions
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Available.png"
    use:
      - $CLASH_SUBNAME      
  - name: é“¾å¼ä¸­è½¬
    type: relay
    proxies:
      - ä¸­è½¬ä»£ç†
      - é“¾å¼è½åœ°
  - name: ä¸­è½¬ä»£ç†
    type: select
    # disable-udp: true
    proxies:
      - é¦™æ¸¯
      - å°æ¹¾
      - éŸ©å›½
      - æ—¥æœ¬
      - ç¾å›½
      - æ–°åŠ å¡
      - å…¶å®ƒ
proxies:
  - name: é“¾å¼è½åœ°
    type: $RTYPE
    server: $RSERVER
    port: $RPORT
    benchmark-url: http://www.apple.com
    benchmark-timeout: 5
    username: $RUSER
    password: $RPASS
    tls: false # https
    skip-cert-verify: true
    
# clash-rulesé¡¹ç›®æä¾›çš„è§„åˆ™é›†
# è§„åˆ™æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ /etc/clash/rules/ ç›®å½•ä¸­
rule-providers:
  reject:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: /etc/clash/rules/reject.yaml
    interval: 86400

  icloud:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: /etc/clash/rules/icloud.yaml
    interval: 86400

  apple:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: /etc/clash/rules/apple.yaml
    interval: 86400

  google:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt"
    path: /etc/clash/rules/google.yaml
    interval: 86400

  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: /etc/clash/rules/proxy.yaml
    interval: 86400

  direct:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: /etc/clash/rules/direct.yaml
    interval: 86400

  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: /etc/clash/rules/private.yaml
    interval: 86400

  gfw:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: /etc/clash/rules/gfw.yaml
    interval: 86400

  greatfire:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/greatfire.txt"
    path: /etc/clash/rules/greatfire.yaml
    interval: 86400

  tld-not-cn:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: /etc/clash/rules/tld-not-cn.yaml
    interval: 86400

  telegramcidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: /etc/clash/rules/telegramcidr.yaml
    interval: 86400

  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: /etc/clash/rules/cncidr.yaml
    interval: 86400

  lancidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: /etc/clash/rules/lancidr.yaml
    interval: 86400
    
  applications:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: /etc/clash/rules/applications.yaml
    interval: 86400

# è§„åˆ™
rules:
  - RULE-SET,applications,DIRECT
  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yacd.haishan.me,DIRECT
  - RULE-SET,private,DIRECT
  - RULE-SET,reject,REJECT
  - RULE-SET,icloud,DIRECT
  - RULE-SET,apple,DIRECT
  - RULE-SET,google,PROXY
  - RULE-SET,proxy,PROXY
  - RULE-SET,direct,DIRECT
  - RULE-SET,lancidr,DIRECT
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,telegramcidr,PROXY
  - GEOIP,LAN,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,PROXY
